# Centralized Image Building
# Build all custom Docker images from a single location

.PHONY: help build-all caddy transmission transmission-exporter vault-tools clean

# Default target
help:
	@echo "Image Building Commands:"
	@echo "  build-all            - Build all custom images"
	@echo "  caddy                - Build Caddy with Cloudflare DNS support"
	@echo "  transmission         - Build Transmission with VPN (Gluetun)"
	@echo "  transmission-exporter - Build ARM64 Transmission Prometheus exporter"
	@echo "  vault-tools          - Build Vault tools image (kubectl, vault-cli, argon2)"
	@echo "  clean                - Remove all built images"

# Build all images
build-all: caddy transmission transmission-exporter vault-tools
	@echo "âœ… All images built successfully"

# Build Caddy with Cloudflare DNS plugin
caddy:
	@echo "ðŸ”¨ Building Caddy with Cloudflare DNS support..."
	@docker build -f caddy/Dockerfile -t caddy:local ../services/caddy
	@echo "âœ… Caddy image built: caddy:local"

# Build Transmission with VPN
transmission:
	@echo "ðŸ”¨ Building Transmission with VPN support..."
	@docker build -f transmission/Dockerfile -t transmission:local ../services/transmission
	@echo "âœ… Transmission image built: transmission:local"

# Build Transmission exporter for ARM64
transmission-exporter:
	@echo "ðŸ”¨ Building Transmission exporter for ARM64..."
	@docker build -f transmission-exporter/Dockerfile -t transmission-exporter:local .
	@echo "âœ… Transmission exporter built: transmission-exporter:local"

# Build Vault tools image
vault-tools:
	@echo "ðŸ”¨ Building Vault tools image (kubectl, vault-cli, argon2)..."
	@docker build -f vault-tools/Dockerfile -t vault-tools:local vault-tools
	@echo "âœ… Vault tools image built: vault-tools:local"

# Clean up built images
clean:
	@echo "ðŸ§¹ Removing built images..."
	@docker rmi caddy:local 2>/dev/null || true
	@docker rmi transmission:local 2>/dev/null || true
	@docker rmi transmission-exporter:local 2>/dev/null || true
	@docker rmi vault-tools:local 2>/dev/null || true
	@echo "âœ… Images cleaned up"