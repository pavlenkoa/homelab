# Default values for app-of-apps
# Application definitions with enabled: true/false
# Environment-specific files override global.environmentName

global:
  # Environment name - used for auto-generating valueFiles path: values/<environmentName>.yaml
  environmentName: ""

  # Set to true to prefix project and app names with environmentName
  prefixNames: false

  repository:
    url: "https://github.com/pavlenkoa/homelab.git"
    targetRevision: "HEAD"

  destination:
    server: "https://kubernetes.default.svc"

  annotations: {}

  syncPolicy:
    # automated:
    #   prune: true
    #   selfHeal: true
    syncOptions:
      - "CreateNamespace=true"
      - "PrunePropagationPolicy=foreground"
      - "PruneLast=true"
      - "ServerSideApply=true"
      - "ServerSideDiff=true"

  finalizers:
    - "resources-finalizer.argocd.argoproj.io"

# Infrastructure - Core cluster services
infrastructure:
  description: "Core cluster infrastructure (CNI, ingress, certificates)"
  # syncPolicy:
  #   automated:
  #     prune: false  # Never auto-prune infrastructure
  #     selfHeal: true
  applications:
    - name: ingress-nginx
      enabled: true
      path: kubernetes/charts/ingress-nginx
      namespace: ingress-nginx
      annotations:
        argocd.argoproj.io/sync-wave: "-2"

    - name: cert-manager
      enabled: true
      path: kubernetes/charts/cert-manager
      namespace: cert-manager
      annotations:
        argocd.argoproj.io/sync-wave: "0"

# Platform - DevOps and management services
platform:
  description: "Platform services and DevOps tools"
  sourceRepos:
    - "https://github.com/pavlenkoa/homelab.git"
    - "https://github.com/pavlenkoa/vault-secrets-generator.git"
  applications:
    - name: argocd
      enabled: true
      path: kubernetes/charts/argocd
      namespace: argocd
      annotations:
        argocd.argoproj.io/sync-wave: "-3"

    - name: vault
      enabled: true
      path: kubernetes/charts/vault
      namespace: vault
      annotations:
        argocd.argoproj.io/sync-wave: "-1"

    - name: external-secrets
      enabled: true
      path: kubernetes/charts/external-secrets
      namespace: external-secrets
      annotations:
        argocd.argoproj.io/sync-wave: "-1"

    - name: vault-secrets-generator
      enabled: true
      repository:
        url: "https://github.com/pavlenkoa/vault-secrets-generator.git"
        targetRevision: "HEAD"
      path: helm/vault-secrets-generator
      namespace: vsg
      annotations:
        argocd.argoproj.io/sync-wave: "0"

    - name: victoriametrics
      enabled: true
      path: kubernetes/charts/victoriametrics
      namespace: monitoring
      annotations:
        argocd.argoproj.io/sync-wave: "1"

    - name: victorialogs
      enabled: false
      path: kubernetes/charts/victorialogs
      namespace: monitoring
      annotations:
        argocd.argoproj.io/sync-wave: "1"

    - name: grafana
      enabled: false
      path: kubernetes/charts/grafana
      namespace: monitoring
      annotations:
        argocd.argoproj.io/sync-wave: "1"

    - name: alloy
      enabled: false
      path: kubernetes/charts/alloy
      namespace: monitoring
      annotations:
        argocd.argoproj.io/sync-wave: "1"

    - name: n8n
      enabled: true
      path: kubernetes/charts/n8n
      namespace: n8n
      annotations:
        argocd.argoproj.io/sync-wave: "1"

# Applications - End-user services
applications:
  description: "End-user applications and services"
  applications:
    - name: external-services
      enabled: true
      path: kubernetes/charts/external-services
      namespace: external-services
      annotations:
        argocd.argoproj.io/sync-wave: "1"

    - name: authelia
      enabled: true
      path: kubernetes/charts/authelia
      namespace: authelia
      annotations:
        argocd.argoproj.io/sync-wave: "1"
