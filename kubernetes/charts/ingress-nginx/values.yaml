# Wrapper chart for ingress-nginx
# Defaults here, environment-specific overrides in values/homelab.yaml

ingress-nginx:
  controller:
    # hostNetwork binds nginx directly to VM's network interface
    hostNetwork: true
    hostPort:
      enabled: true
    dnsPolicy: ClusterFirstWithHostNet

    # Service still useful for internal cluster access
    service:
      type: ClusterIP

    # Enable additional features
    enableAnnotationValidations: true

    # Metrics (disabled - no Prometheus Operator)
    metrics:
      enabled: false

    # Resource limits
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

    # Only 1 replica - port 80/443 conflict with hostNetwork
    replicaCount: 1

    # Recreate strategy required for hostNetwork (can't have 2 pods on same port)
    updateStrategy:
      type: Recreate

    # PDB disabled with single replica
    podDisruptionBudget:
      enabled: false

    # Nginx configuration
    config:
      # Enable real IP forwarding
      use-forwarded-headers: "true"
      compute-full-forwarded-for: "true"

      # SSL configuration
      ssl-protocols: "TLSv1.2 TLSv1.3"
      ssl-ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384"

      # Performance tuning
      worker-processes: "auto"
      max-worker-connections: "16384"

  # Default backend service
  defaultBackend:
    enabled: true
    resources:
      limits:
        cpu: 50m
        memory: 64Mi
      requests:
        cpu: 10m
        memory: 20Mi

  # Admission webhooks
  admissionWebhooks:
    enabled: true
    resources:
      limits:
        cpu: 50m
        memory: 64Mi
      requests:
        cpu: 10m
        memory: 20Mi
