# Vault Secrets Generator - Test deployment
# This creates a test secret in Vault to verify the setup works

image:
  tag: "latest"

# Service account name must match *-secret-generator pattern for Vault role
serviceAccount:
  name: "vsg-secret-generator"

vault:
  address: "http://vault.vault.svc.cluster.local:8200"

auth:
  method: kubernetes
  kubernetes:
    role: "secret-generator"

# Test configuration - generate a simple secret
config:
  inline: |
    vault {
      address = "http://vault.vault.svc.cluster.local:8200"
      auth {
        method = "kubernetes"
        role   = "secret-generator"
      }
    }

    secret "kv/vsg-test" {
      test_password = generate()
      test_static   = "hello-from-vsg"
      deployed_at   = env("DEPLOY_TIME")
    }

# Add timestamp env var for testing
env:
  - name: DEPLOY_TIME
    value: "2024-12-14"

# Job settings
job:
  ttlSecondsAfterFinished: 600
  backoffLimit: 3

resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 50m
    memory: 64Mi
